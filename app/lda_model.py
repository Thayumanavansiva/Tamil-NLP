# -*- coding: utf-8 -*-
"""Copy of LDA_without_coreference_resolution.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1rXVkOCEqedHQWDQ316Z_szKpRcyAVpfW

# Latent Dirichlet's Allocation ( LDA )
"""
import nltk
from nltk.corpus import stopwords
nltk.download('stopwords')
stopwords=stopwords.words('tamil')

tamil_lemmatized_stopwords = [
    "ஆகு", "உள்", "அமை", "பெறு", "விளங்கு", "உருவாகு", "பெயர்", "நேசி", "வலியுறுத்து",
    "முயல்", "பகிர்", "   எழுது", "உள்ளிடு", "கட்டியெழு", "முக்கியம்", "பங்காற்று", "இன்", "மேன்",
    "என", "உண்டாகு", "கொள்", "அளவு", "நடைபெறு", "தொகு", "வாங்கு", "செய்","உம்",'ஆன'
]

tamil_stopwords = [
    "ஒரு", "என்று", "மற்றும்", "இந்த", "இது", "என்ற", "கொண்டு", "என்பது", "பல", "ஆகும்",
    "அல்லது", "அவர்", "நான்", "உள்ள", "அந்த", "இவர்", "என", "முதல்", "என்ன", "இருந்து",
    "சில", "என்", "போன்ற", "வேண்டும்", "வந்து", "இதன்", "அது", "அவன்", "தான்", "பலரும்",
    "என்னும்", "மேலும்", "பின்னர்", "கொண்ட", "இருக்கும்", "தனது", "உள்ளது", "போது", "என்றும்",
    "அதன்", "தன்", "பிறகு", "அவர்கள்", "வரை", "அவள்", "நீ", "ஆகிய", "இருந்தது", "உள்ளன",
    "வந்த", "இருந்த", "மிகவும்", "இங்கு", "மீது", "ஓர்", "இவை", "இந்தக்", "பற்றி", "வரும்",
    "வேறு", "இரு", "இதில்", "போல்", "இப்போது", "அவரது", "மட்டும்", "இந்தப்", "எனும்", "மேல்",
    "பின்", "சேர்ந்த", "ஆகியோர்", "எனக்கு", "இன்னும்", "அந்தப்", "அன்று", "ஒரே", "மிக", "அங்கு",
    "பல்வேறு", "விட்டு", "பெரும்", "அதை", "பற்றிய", "உன்", "அதிக", "அந்தக்", "பேர்", "இதனால்",
    "அவை", "அதே", "ஏன்", "முறை", "யார்", "என்பதை", "எல்லாம்", "மட்டுமே", "இங்கே", "அங்கே",
    "இடம்", "இடத்தில்", "அதில்", "நாம்", "அதற்கு", "எனவே", "பிற", "சிறு", "மற்ற", "விட",
    "எந்த", "எனவும்", "எனப்படும்", "எனினும்", "அடுத்த", "இதனை", "இதை", "கொள்ள", "இந்தத்",
    "இதற்கு", "அதனால்", "தவிர", "போல", "வரையில்", "சற்று", "எனக்","அந்த", "இந்த", "எந்த", "ஒரு", "தான்", "என்று", "என்ன", "இருந்த", "என்னும்", "இதனால்",
    "ஆனால்", "அதனால்", "எப்படி", "ஏன்", "என்று", "ஏனெனில்", "எப்போது", "என்னை", "உங்களை",
    "எதற்கு", "எதுவும்", "எவர்", "யார்", "எங்கே", "எதனால்", "எதற்காக", "இதற்கு", "அதற்கு",
    "இதனால்", "அதனால்", "இதற்கு", "அதற்கு", "இங்கு", "அங்கு", "எங்கு", "தான்", "தான்",
    "இவை", "அவை", "இவள்", "அவள்", "இவர்", "அவர்", "இவர்கள்", "அவர்கள்", "இது", "அது",
    "இதுவே", "அதுவே", "இவை", "அவை", "இதற்கு", "அதற்கு", "எதற்கு", "எதுவும்", "ஏதாவது",
    "எப்போதும்", "எப்போதும்", "எவ்வளவு", "இப்போது", "அப்போது", "எப்போது", "இதுவரை",
    "அதுவரை", "எவரும்", "யாரும்", "எதுவும்", "ஏதாவது", "எப்போதும்", "எவ்வளவு", "இப்போது",
    "அப்போது", "எப்போது", "இதுவரை", "அதுவரை", "எவரும்", "யாரும்", "எதுவும்", "ஏதாவது",
    "எப்போதும்", "எவ்வளவு", "இப்போது", "அப்போது", "எப்போது", "இதுவரை", "அதுவரை", "எவரும்",
    "யாரும்", "எதுவும்", "ஏதாவது", "எப்போதும்", "எவ்வளவு", "இப்போது", "அப்போது", "எப்போது",
    "இதுவரை", "அதுவரை", "எவரும்", "யாரும்", "எதுவும்", "ஏதாவது", "எப்போதும்", "எவ்வளவு",
    "இப்போது", "அப்போது", "எப்போது", "இதுவரை", "அதுவரை", "எவரும்", "யாரும்", "எதுவும்",
    "ஏதாவது", "எப்போதும்", "எவ்வளவு", "இப்போது", "அப்போது", "எப்போது", "இதுவரை", "அதுவரை",
    "எவரும்", "யாரும்", "எதுவும்", "ஏதாவது", "எப்போதும்", "எவ்வளவு", "இப்போது", "அப்போது",
    "எப்போது", "இதுவரை", "அதுவரை", "எவரும்", "யாரும்", "எதுவும்", "ஏதாவது", "எப்போதும்",
    "எவ்வளவு", "இப்போது", "அப்போது", "எப்போது", "இதுவரை", "அதுவரை", "எவரும்", "யாரும்",
    "எதுவும்", "ஏதாவது", "எப்போதும்", "எவ்வளவு", "இப்போது", "அப்போது", "எப்போது", "இதுவரை",
    "அதுவரை", "எவரும்", "யாரும்", "எதுவும்", "ஏதாவது", "எப்போதும்", "எவ்வளவு", "இப்போது",
    "அப்போது", "எப்போது", "இதுவரை", "அதுவரை", "எவரும்", "யாரும்", "எதுவும்", "ஏதாவது",
    "எப்போதும்", "எவ்வளவு", "இப்போது", "அப்போது", "எப்போது", "இதுவரை", "அதுவரை", "எவரும்",
    "யாரும்", "எதுவும்", "ஏதாவது", "எப்போதும்", "எவ்வளவு", "இப்போது","!", "?", ",", ";", ":", "-", "_", "—", "(", ")", "[", "]", "{", "}",
    "@", "#", "$", "%", "^", "&", "*", "+", "=", "/", "\\", "|", "~", "`",
    "'", "\"","<",">","…" ]

stopwords.extend(tamil_stopwords)
stopwords.extend(tamil_lemmatized_stopwords)

tamil_para="""
இயேசு (Jesus[e]; அண். 6 4 பொ. ஊ. மு. – பொ.  ஊ. 30 33, நசரேத்தின் இயேசு இயேசு கிறிஸ்து பெயர்களாலும் தலைப்புக்களாலும் அறியப்படுகிறார்)[f] என்பவர் முதலாம் நூற்றாண்டு யூத போதகரும், சமயத் தலைவரும் ஆவார். [12] உலகின் மிகப்பெரிய சமயமான கிறிஸ்தவத்தின் மைய நபரும் ஆவார். பெரும்பாலான கிறிஸ்தவர்கள் கடவுளின் மகனாக அவதரித்தார் என்றும், எபிரேய வேதாகமத்தில் முன்னறிவிக்கப்பட்ட மெசியா (கிறிஸ்து) நம்புகிறார்கள். பண்டைக் காலத்தை ஆய்வு செய்யும் கிட்டத்தட்ட அனைத்து நவீன அறிஞர்களும் இயேசுவின் வரலாற்றுத் தன்மையை ஒப்புக் கொள்கின்றனர். [g] இயேசுவின் வாழ்வு குறித்த விவரங்கள் நற்செய்திகளில், குறிப்பாக புதிய ஏற்பாட்டின் நான்கு திருமுறை நற்செய்திகளில் உள்ளடங்கியுள்ளன. கல்வி சார்ந்த ஆய்வானது நற்செய்திகளின் வரலாற்று நம்பகத் தன்மை வரலாற்று நபராக இயேசுவை அளவுக்கு நெருக்கமாக பிரதிபலிக்கின்றன குறித்து பரவலான பார்வைகளைக் கொடுக்கிறது. [20][h][23][24] பிறந்து எட்டாம் நாளில் பின்பற்றுவோரைப் விருத்தசேதனம் செயப்பட்டது. பின்பற்றுவோரைப் திருமுழுக்கு யோவான் என்பவரிடம் திருமுழுக்கு பெற்றார். 40 பகல்கள் இரவுகள் யூதேயா பாலைவனத்தில் நோன்பிருந்த நற்செய்தி அறிவிக்கும் ஊழியத்தைத் தொடங்கினார். பெயர்ந்து போதித்த ஆசிரியர் என்பதால் பெரும்பாலும் "ரபி" அழைக்கப்பட்டார். [25] கடவுளை எவ்வாறு பின்பற்ற இயேசு சக யூதர்களுடன் விவாதித்தார். நோயாளிகளைக் குணப்படுத்தினார்; உவமைகள் மூலம் போதித்தார். பின்பற்றுவோரைப் பெற்றார். உரோமை பின்பற்றியவர்களில் பனிரெண்டு உரோமை முதன்மையான சீடர்கள் ஆவர். தன்னை கடவுள் உரோமை கடவுள் செய்யக்கூடிய பாவ மன்னிப்பைப் உரோமை வழங்கியது விடயங்கள் மூலம் யூத அதிகாரிகளின் கோபத்திற்கு உள்ளானார். [26] எருசலேத்தில் கைது செய்யப்பட்டார். யூத தலைமைச் சங்கத்தால் விசாரிக்கப்பட்டார். [26] உரோமை அரசின் முன் நிறுத்தப்பட்டார். வாய் தொடர்ந்து யூதேயாவின் உரோமை ஆளுநர் பொந்தியு பிலாத்து என்பவரின் கட்டளைப்படி இயேசு சிலுவையில் அறையப்பட்டார். [27] இயேசு இறந்த மூன்றாம் நாள் உயிர்த்தெழுந்ததாக பார்த்து நம்பி வாய் சீடர்கள் இணைந்து தோற்றுவித்த சமுதாயம் தொடக்க கால கிறித்தவமாக வளர்ந்தது. [28] வாய் போதனைகள் வாழ்வு குறித்த விவரங்களானவை தொடக்கத்தில் வாய் வழிச் செய்திகளாக பகிரப்பட்டன. இவையே எழுதப்பட்ட நற்செய்திகளுக்கு ஆதாரங்களாக விளங்கின."""

import re
from gensim import corpora, models

# input text after coreference

class lda:
    def __init__(self, input_text: str):
        self.input_text = input_text
        self.title_keywords = self.get_keywords()


    # Function to clean + tokenize Tamil text
    def preprocess(self, text):
        # Basic sentence split using punctuation
        sentences = re.split(r"[.!?\n]", text)
        docs = [sentence.strip() for sentence in sentences if sentence.strip()]

        tokenized_docs = []
        for sent in docs:
            # Remove unwanted symbols
            cleaned = re.sub(r"[^அ-ஹஂஃா-ூெ-ைொ-்\s]", "", sent)
            # Tokenize (split) and remove stopwords
            tokens = [word for word in cleaned.split() if word not in stopwords]
            tokenized_docs.append(tokens)

        return tokenized_docs


    def get_keywords(self):
        tokenized_docs = self.preprocess(self.input_text)

        # Create dictionary and corpus
        dictionary = corpora.Dictionary(tokenized_docs)
        corpus = [dictionary.doc2bow(doc) for doc in tokenized_docs]

        # Train LDA model (1 topic, since it's 1 paragraph)
        lda_model = models.LdaModel(corpus=corpus, id2word=dictionary, num_topics=1, passes=10, random_state=42)

        # Get the top topic
        top_topic = lda_model.show_topic(0, topn=1)
        get_keywords = [word for word, prob in top_topic]
        return get_keywords

def get_topic(input_text: str) -> str:
    nlp=lda(input_text)
    root_topic=nlp.title_keywords
    return root_topic